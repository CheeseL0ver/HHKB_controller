RN-42 Power saving
------------------
Reset pin control is needed?
CTS, RTS are needed?


Serial No Silk
--------------
"Rev. A"
"Ser. _______" Numbering can be written by hand.








###############################################################################################
# DECIDED
###############################################################################################

HHKB switch power control
-------------------------
OK: Rev.A low side FET switch works.


Protocol Switching
------------------
Rules of switching:
- Seeing whether BT module can respond
- Seeing whether BT module is powered(detect it with I/O pin)
- Using VUSB line interrupt to see USB is available


Power Management
----------------
DECIDED

- Power source selector: using FET load switches select LIPO or USB as power source
- Physical Switch(DPST/DPDT): Turn on/off BT module and LIPO(switch BT/USB)

    Switch  USB cable       LIPO        keyboard    USB debug   UART debug  Description
    -----------------------------------------------------------------------------------------------
    On      Connected       Charge      BT          On          On          BT Keyboard/Charging
    Off     Connected       Charge      USB         On          On          USB Keyboard/Charging
    On      Not connected   Discharge   BT          Off         On          BT Keyboard mode
    Off     Not connected   Off         Off         Off         Off         Battery Saving/Not Used


Power Source Selector:

           +------------Jumper1---------------------------+
           | +--Jumper2-+                                 |
           | |          |                                 |
    VUSB---+-----FET-------+----DC-DC(5V)----+------------+-------MCU/HHKB
           |               |                 |
         Charger          FET                +---DC-DC(3.3V)--SW--BT
           |               |
          LIPO-----SW------+

    Jumper1: 5V direct from VUSB(without BT/LIPO/5VDCDC option)
    Jumper2: 5V created with Boost converter(without BT/LIPO option)




FET Selection
--------------------
Can change decision AFTER PCB design

Uno, Leonardo uses FET: FDN340P
http://arduino.cc/en/uploads/Main/Arduino_Uno_Rev3-schematic.pdf
http://arduino.cc/en/uploads/Main/arduino-leonardo-schematic_3b.pdf
Duemilanove uses NDT2955
http://arduino.cc/en/uploads/Main/arduino-duemilanove-schematic.pdf

FDN340P - P-Ch Power Trench CMOS
https://www.fairchildsemi.com/ds/FD/FDN340P.pdf
Rds     60mOhm, Vgs=-4.5 Id=-2A

NDT2955 - P-Ch
http://www.fairchildsemi.com/ds/ND/NDT2955.pdf
Rds     163mOhm, Vgs=-4.5 Id=-2A

Power FET list:
http://www.latticesemi.com/~/media/Documents/ApplicationNotes/UsingPowerMOSFETswithPowerManagerDevices.ashx





Power Switching
---------------
DONE: Using two FETs switch power sources

Rule of switch between Lipo battery and USB power:
- Power is souced from USB when cable is connected
- Power is souced from Lipo when cable is disconnected
- Always charging Lipo whenever USB cable is connected


http://forum.arduino.cc/index.php?topic=22596.0
http://www.onsemi.com/pub_link/Collateral/AND9093-D.PDF
http://www.eetimes.com/document.asp?doc_id=1272433



Diode O-ring selector
---------------------
Schottkys are usually used to minimize voltage drop. The heighest voltage power source is selected in Output.

    PS1 --|>S----+
                 |
    PS2 --|>S----+--- OUT
                 |
    PS3 --|>S----+

http://www.codemsys.com/SMPS/Parallel.htm

### MOSFET O-Ring
http://www.edn.com/design/analog/4368307/Use-op-amps-to-make-automatic-ORing-power-selector




Reverse Plolarity Protection
----------------------------
NOT NEEDED: USB connector has physical  polarity protection.

<http://www.ti.com/lit/an/slva139/slva139.pdf>


### MOS FET
Low loss comparing with diode.

LTC4054 datasheet Fig6

         PMOS FET
    VIN----->|-----VOUT
            ^
            |
           GND

    VIN-----+------VOUT
            |
            V
    GND----|<------GND
         NMOS FET

FET's body diode is oriented in the direction of normal current flow.

Example of FET DS resistance. Less than 100mOhm at normal operational voltage.
- 80mR at 2.7V
- 51mR at 1.8V

### Schottky diode
Cost is not low as normal diode.

    VIN----->|-----VOUT


Voltage Shifter
---------------
DONE

         3.3V        5V
         |           |
         +------+    |
         R 10K  |    R 10K
   3.3V  |     ___   |
   IN----+-----^ ----+------OUT 5V
              BSS138 N-Ch

key state PIN pull up resistor(R1)
----------------------------------
DONE: Removed

    1KOhm is too strong it doesn't work.
    10KOhm works. Without pull up resistor it also works well.
    This land should be removed?

Mini USB receptacle
-------------------
DONE:

    a bit more left? 0.1? 0.2mm?

